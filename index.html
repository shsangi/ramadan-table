<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UAE Ramadan Timings ðŸŒ™ Sehar & Iftar</title>
  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,300;14..32,400;14..32,500;14..32,600;14..32,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(145deg, #f0f4fa 0%, #e2ecf5 100%);
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
      padding: 1.5rem;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .glass-card {
      max-width: 1200px;
      width: 100%;
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-radius: 3rem;
      box-shadow: 0 30px 60px -15px rgba(0, 40, 65, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.6);
      padding: 2.2rem;
    }

    /* Header */
    .main-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .main-header h1 {
      font-size: 2.2rem;
      font-weight: 700;
      background: linear-gradient(145deg, #0e3a4f, #1d5b7a);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .main-header h1 i {
      background: white;
      padding: 12px 16px;
      border-radius: 60px;
      box-shadow: 0 10px 20px rgba(0, 60, 80, 0.1);
      -webkit-text-fill-color: #1d5b7a;
    }

    .hijri-badge {
      background: rgba(29, 91, 122, 0.1);
      padding: 0.6rem 1.5rem;
      border-radius: 40px;
      font-weight: 500;
      color: #1d5b7a;
      border: 1px solid rgba(29, 91, 122, 0.2);
    }

    /* City Selector */
    .city-section {
      margin-bottom: 2rem;
    }

    .city-label {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #54738f;
      margin-bottom: 0.5rem;
    }

    .city-selector {
      position: relative;
      max-width: 300px;
    }

    .city-selector select {
      width: 100%;
      padding: 1rem 2.5rem 1rem 1.5rem;
      border: 2px solid rgba(120, 160, 190, 0.2);
      border-radius: 60px;
      font-size: 1.2rem;
      font-weight: 600;
      color: #0e3a4f;
      background: white;
      appearance: none;
      cursor: pointer;
      transition: all 0.2s;
    }

    .city-selector select:hover {
      border-color: #8bb9d4;
    }

    .city-selector i {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      color: #7f9eb5;
      pointer-events: none;
    }

    /* Featured Card */
    .featured-card {
      background: linear-gradient(145deg, #0e3a4f, #124f6b);
      border-radius: 2.2rem;
      padding: 2rem 2.5rem;
      margin-bottom: 2.5rem;
      color: white;
      box-shadow: 0 25px 40px -10px rgba(8, 65, 90, 0.4);
    }

    .featured-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .featured-city {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .featured-city h2 {
      font-size: 2.2rem;
      font-weight: 600;
    }

    .today-badge-large {
      background: rgba(255, 255, 255, 0.2);
      padding: 0.4rem 1.2rem;
      border-radius: 40px;
      font-size: 0.9rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
      backdrop-filter: blur(4px);
    }

    .featured-times {
      display: flex;
      justify-content: space-around;
      align-items: center;
      flex-wrap: wrap;
      gap: 2rem;
    }

    .featured-time-item {
      text-align: center;
      flex: 1;
      min-width: 200px;
    }

    .featured-time-label {
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      opacity: 0.9;
      margin-bottom: 0.5rem;
    }

    .featured-time-label i {
      margin-right: 6px;
    }

    .featured-time-value {
      font-size: 3rem;
      font-weight: 700;
      line-height: 1.2;
      margin-bottom: 0.3rem;
    }

    .featured-time-extra {
      font-size: 0.95rem;
      opacity: 0.8;
    }

    .featured-time-extra i {
      margin-right: 4px;
    }

    /* Daily Timings Header */
    .daily-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .daily-header h3 {
      font-size: 1.5rem;
      font-weight: 600;
      color: #0e3a4f;
    }

    .daily-header h3 i {
      color: #ffb347;
      margin-right: 10px;
    }

    .today-summary {
      background: white;
      padding: 0.5rem 1.5rem;
      border-radius: 40px;
      display: flex;
      gap: 1.5rem;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.03);
    }

    .today-summary span {
      display: flex;
      align-items: center;
      gap: 6px;
      color: #1d5b7a;
    }

    /* Grid */
    .timings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.2rem;
      margin-top: 1rem;
    }

    .timing-card {
      background: white;
      border-radius: 1.8rem;
      padding: 1.5rem;
      border: 1px solid rgba(160, 195, 220, 0.3);
      transition: all 0.2s;
    }

    .timing-card.today-card {
      background: #fef9f0;
      border-left: 6px solid #ffb347;
    }

    .card-day {
      font-size: 1rem;
      color: #5f7e99;
      margin-bottom: 0.8rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-day .day-number {
      font-weight: 700;
      color: #0e3a4f;
    }

    .card-city-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .card-city-name {
      font-size: 1.2rem;
      font-weight: 700;
      color: #0e3a4f;
      text-transform: capitalize;
    }

    .today-mini-badge {
      background: #ffb347;
      color: white;
      padding: 0.2rem 1rem;
      border-radius: 30px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .card-date {
      background: #f5f9fe;
      padding: 0.8rem;
      border-radius: 1.2rem;
      margin-bottom: 1rem;
      font-size: 0.95rem;
      color: #2b5a78;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-prayer-times {
      display: flex;
      justify-content: space-around;
    }

    .prayer-col {
      text-align: center;
    }

    .prayer-col i {
      color: #8aadc7;
      font-size: 1rem;
    }

    .prayer-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      color: #6f8da5;
      margin: 4px 0 2px;
    }

    .prayer-value {
      font-weight: 700;
      font-size: 1.1rem;
    }

    .sehar-value {
      color: #0d5b8c;
    }

    .iftar-value {
      color: #c45d2c;
    }

    .count-badge {
      background: white;
      padding: 0.4rem 1.2rem;
      border-radius: 30px;
      font-weight: 500;
      color: #1d5b7a;
    }

    .empty-message {
      grid-column: 1 / -1;
      text-align: center;
      padding: 4rem;
      color: #8aadc7;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 2rem;
    }

    .footer-note {
      margin-top: 2rem;
      text-align: right;
      color: #7f9eb5;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
<div class="glass-card">
  <!-- Header -->
  <div class="main-header">
    <h1>
      <i class="fas fa-star-and-crescent"></i>
      Ramadan Timings
    </h1>
    <div class="hijri-badge">
      <i class="fas fa-calendar-alt"></i> 1447 AH
    </div>
  </div>

  <!-- City Selection -->
  <div class="city-section">
    <div class="city-label">CITY</div>
    <div class="city-selector">
      <select id="cityFilter"></select>
      <i class="fas fa-chevron-down"></i>
    </div>
  </div>

  <!-- Featured Section (Today's Card) -->
  <div id="featuredCard" style="display: none;"></div>

  <!-- Daily Timings Header -->
  <div class="daily-header">
    <h3>
      <i class="far fa-clock"></i>
      Daily Timings
    </h3>
    <div class="today-summary" id="todaySummary">
      <span><i class="fas fa-city"></i> <span id="summaryCity">Dubai</span></span>
      <span><i class="far fa-calendar-alt"></i> <span id="summaryDate">18 February 2026</span></span>
      <span><i class="fas fa-moon"></i> Day <span id="summaryDay">1</span></span>
    </div>
  </div>

  <!-- Timings Grid -->
  <div id="timingsGrid" class="timings-grid"></div>

  <div class="footer-note">
    âœ¨ Sehar = Imsak Â· Iftar = Maghrib
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
  (async function() {
    const EXCEL_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTHHGzGgCOIU1wFXePrBXtPCdORBq2udUiQu-jd45N3GkWDOnT4iQu0H18ArMVxnU-ohZAbYZZkduAX/pub?output=xlsx';
    
    function formatExcelTime(excelTime) {
      if (!excelTime && excelTime !== 0) return 'â€”';
      
      if (typeof excelTime === 'string') {
        if (excelTime.includes('AM') || excelTime.includes('PM') || excelTime.includes(':')) {
          return excelTime;
        }
      }
      
      const totalSeconds = Math.round(excelTime * 24 * 60 * 60);
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      
      const period = hours >= 12 ? 'PM' : 'AM';
      const displayHours = hours % 12 || 12;
      const displayMinutes = minutes.toString().padStart(2, '0');
      
      return `${displayHours}:${displayMinutes} ${period}`;
    }

    function formatExcelDate(excelDate) {
      if (!excelDate) return '';
      if (typeof excelDate === 'string') return excelDate;
      
      const date = new Date((excelDate - 25569) * 86400 * 1000);
      return date.toLocaleDateString('en-GB', {
        day: 'numeric',
        month: 'long',
        year: 'numeric'
      });
    }

    let allRows = [];
    
    try {
      const response = await fetch(EXCEL_URL);
      const arrayBuffer = await response.arrayBuffer();
      const workbook = XLSX.read(arrayBuffer, { type: 'array' });
      
      const sheetName = 'UAE';
      const worksheet = workbook.Sheets[sheetName] || workbook.Sheets[workbook.SheetNames[0]];
      const data = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
      
      if (data.length < 2) throw new Error('Not enough data');
      
      for (let i = 1; i < data.length; i++) {
        const row = data[i];
        if (!row || row.length < 11) continue;
        
        const city = row[10];
        if (!city) continue;
        
        let isToday = row[12];
        if (typeof isToday === 'string') {
          isToday = isToday.toUpperCase() === 'TRUE' || isToday === '1';
        } else {
          isToday = Boolean(isToday);
        }
        
        allRows.push({
          ramadanDay: row[0] || '',
          weekday: row[1] || '',
          date: formatExcelDate(row[2]),
          sehar: formatExcelTime(row[3]),
          iftar: formatExcelTime(row[8]),
          city: String(city).trim().toLowerCase(),
          isToday: isToday
        });
      }
      
    } catch (error) {
      console.error('Error loading Excel, using demo data:', error);
      allRows = [
        { ramadanDay: '1', weekday: 'Wednesday', date: '18 February 2026', sehar: '5:24 AM', iftar: '6:18 PM', city: 'dubai', isToday: true },
        { ramadanDay: '2', weekday: 'Thursday', date: '19 February 2026', sehar: '5:23 AM', iftar: '6:19 PM', city: 'dubai', isToday: false },
        { ramadanDay: '3', weekday: 'Friday', date: '20 February 2026', sehar: '5:22 AM', iftar: '6:19 PM', city: 'dubai', isToday: false },
        { ramadanDay: '4', weekday: 'Saturday', date: '21 February 2026', sehar: '5:21 AM', iftar: '6:20 PM', city: 'dubai', isToday: false },
        { ramadanDay: '5', weekday: 'Sunday', date: '22 February 2026', sehar: '5:21 AM', iftar: '6:20 PM', city: 'dubai', isToday: false }
      ];
    }

    // Get unique cities
    const cities = [...new Set(allRows.map(r => r.city))].filter(Boolean).sort();
    
    // Populate dropdown
    const citySelect = document.getElementById('cityFilter');
    cities.forEach(city => {
      const option = document.createElement('option');
      option.value = city;
      option.textContent = city.charAt(0).toUpperCase() + city.slice(1);
      citySelect.appendChild(option);
    });
    
    const defaultCity = cities.find(c => c === 'dubai') || cities[0] || 'dubai';
    citySelect.value = defaultCity;

    // DOM elements
    const featuredCard = document.getElementById('featuredCard');
    const timingsGrid = document.getElementById('timingsGrid');
    const summaryCity = document.getElementById('summaryCity');
    const summaryDate = document.getElementById('summaryDate');
    const summaryDay = document.getElementById('summaryDay');

    function renderTable(selectedCity) {
      const cityRows = allRows.filter(row => row.city === selectedCity);
      const todayRow = cityRows.find(row => row.isToday) || cityRows[0]; // Fallback to first row if no today
      
      // Update summary
      if (todayRow) {
        summaryCity.textContent = todayRow.city.charAt(0).toUpperCase() + todayRow.city.slice(1);
        summaryDate.textContent = todayRow.date;
        summaryDay.textContent = todayRow.ramadanDay;
      }
      
      // Render featured card exactly as requested
      if (todayRow) {
        featuredCard.style.display = 'block';
        featuredCard.innerHTML = `
          <div class="featured-card">
            <div class="featured-header">
              <div class="featured-city">
                <h2>${todayRow.city.charAt(0).toUpperCase() + todayRow.city.slice(1)}</h2>
                <span class="today-badge-large">
                  <i class="fas fa-calendar-check"></i> TODAY
                </span>
              </div>
            </div>
            <div class="featured-times">
              <div class="featured-time-item">
                <div class="featured-time-label">
                  <i class="fas fa-moon"></i> SEHAR (IMSAK)
                </div>
                <div class="featured-time-value">${todayRow.sehar}</div>
                <div class="featured-time-extra">
                  <i class="fas fa-moon"></i> Ramadan ${todayRow.ramadanDay}
                </div>
              </div>
              <div class="featured-time-item">
                <div class="featured-time-label">
                  <i class="fas fa-sun"></i> IFTAR (MAGHRIB)
                </div>
                <div class="featured-time-value">${todayRow.iftar}</div>
                <div class="featured-time-extra">
                  <i class="far fa-calendar-alt"></i> ${todayRow.weekday}, ${todayRow.date}
                </div>
              </div>
            </div>
          </div>
        `;
      } else {
        featuredCard.style.display = 'none';
      }
      
      // Render grid
      if (cityRows.length === 0) {
        timingsGrid.innerHTML = `<div class="empty-message"><i class="fas fa-map-marker-alt"></i> No timings found for ${selectedCity}</div>`;
        return;
      }
      
      let gridHtml = '';
      cityRows.forEach(row => {
        const isToday = row.isToday;
        gridHtml += `
          <div class="timing-card ${isToday ? 'today-card' : ''}">
            <div class="card-day">
              <i class="fas fa-moon"></i>
              <span class="day-number">Day ${row.ramadanDay}</span>
            </div>
            <div class="card-city-row">
              <span class="card-city-name">${row.city}</span>
              ${isToday ? '<span class="today-mini-badge">TODAY</span>' : ''}
            </div>
            <div class="card-date">
              <i class="far fa-calendar-alt"></i> ${row.weekday}, ${row.date}
            </div>
            <div class="card-prayer-times">
              <div class="prayer-col">
                <i class="fas fa-moon"></i>
                <div class="prayer-label">SEHAR</div>
                <div class="prayer-value sehar-value">${row.sehar}</div>
              </div>
              <div class="prayer-col">
                <i class="fas fa-sun"></i>
                <div class="prayer-label">IFTAR</div>
                <div class="prayer-value iftar-value">${row.iftar}</div>
              </div>
            </div>
          </div>
        `;
      });
      
      timingsGrid.innerHTML = gridHtml;
    }

    // Initial render
    renderTable(defaultCity);
    
    // Dropdown change
    citySelect.addEventListener('change', (e) => {
      renderTable(e.target.value);
    });

  })();
</script>
</body>
</html>
